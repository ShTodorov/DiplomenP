@page "/product_page/{productId}"
@using DiplomenP.Data;
@using DiplomenP.Interfaces;
@using DiplomenP.Models;
@inject ICartService CartService
@inject NavigationManager NavigationManager

<PageTitle></PageTitle>

    <section class="py-5">
        <div class="container px-4 px-lg-5 my-5">
            <div class="row gx-4 gx-lg-5 align-items-center">

                <div class="col-md-6"><img class="card-img-top mb-5 mb-md-0" src="@product.Image" alt="product"></div>

                <div class="col-md-6">

                    <div class="mb-1">Категория: @product.Type</div>

                    <div class="mb-1">Марка: @product.Brand</div>

                    <h1 class="display-6 fw-bolder">@product.ProductName</h1>

                    <div class="mb-4">
                        <p class="fs-3">@product.Price.ToString("0.00") лв.</p>
                    </div>

                    <p class="lead m-1">Описание:</p>

                    <p class="lead">@product.Description</p>

                    <div class="mb-2 mt-3">Налични бройки: @product.ProductCount</div>

                    <div class="d-flex">
                        <input class="form-control text-center" id="inputQuantity" type="text" @bind-value="quantity" style="max-width: 4rem; margin-right: 10px;" required>
                        <button class="btn btn-outline-dark flex-shrink-0" type="button" @onclick="AddToCart">
                            <i class="bi-cart-fill me-1"></i>
                            Add to cart
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </section>


@code {
    [Inject]
    private ApplicationDbContext dbContext { get; set; }

    [Parameter]
    public string productId { get; set; }

    private Product product { get; set; }

    private int quantity { get; set; }

    protected override async Task OnInitializedAsync()
    {
        int id = int.Parse(productId);
        product = await dbContext.Products.FindAsync(id);
    }

    private async Task AddToCart()
    {
        var userId = "12345";
        int id = int.Parse(productId);
        await CartService.AddToCart(id, quantity, userId);
        NavigationManager.NavigateTo($"/shopping_cart");
    }

}